<div class="cv-form-container" *ngIf="!loading">
  <div class="progress-bar">
    <div class="progress-step" [class.active]="currentStep >= 1" (click)="goToStep(1)">
      <span class="step-number">1</span>
      <span class="step-label">Infos</span>
    </div>
    <div class="progress-step" [class.active]="currentStep >= 2" (click)="goToStep(2)">
      <span class="step-number">2</span>
      <span class="step-label">Formations</span>
    </div>
    <div class="progress-step" [class.active]="currentStep >= 3" (click)="goToStep(3)">
      <span class="step-number">3</span>
      <span class="step-label">Exp√©riences</span>
    </div>
    <div class="progress-step" [class.active]="currentStep >= 4" (click)="goToStep(4)">
      <span class="step-number">4</span>
      <span class="step-label">Stages</span>
    </div>
    <div class="progress-step" [class.active]="currentStep >= 5" (click)="goToStep(5)">
      <span class="step-number">5</span>
      <span class="step-label">Langues</span>
    </div>
    <div class="progress-step" [class.active]="currentStep >= 6" (click)="goToStep(6)">
      <span class="step-number">6</span>
      <span class="step-label">Comp√©tences</span>
    </div>
  </div>

  <form [formGroup]="cvForm" (ngSubmit)="onSubmit()" class="cv-form">
    
    <div class="form-step" *ngIf="currentStep === 1">
      <h2>‚úèÔ∏è Modifier le CV</h2>
      
      <div class="form-row">
        <div class="form-group">
          <label for="nom">Nom *</label>
          <input type="text" id="nom" formControlName="nom" class="form-control" placeholder="DUPONT">
        </div>
        
        <div class="form-group">
          <label for="prenom">Pr√©nom *</label>
          <input type="text" id="prenom" formControlName="prenom" class="form-control" placeholder="Jean">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="email">Email *</label>
          <input type="email" id="email" formControlName="email" class="form-control" placeholder="jean.dupont@email.com">
        </div>
        
        <div class="form-group">
          <label for="telephone">T√©l√©phone *</label>
          <input type="tel" id="telephone" formControlName="telephone" class="form-control" placeholder="0612345678">
        </div>
      </div>

      <div class="form-group">
        <label for="adresse">Adresse</label>
        <textarea id="adresse" formControlName="adresse" class="form-control" rows="2" placeholder="123 Rue de la Paix, 75000 Paris"></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="dateNaissance">Date de naissance</label>
          <input type="date" id="dateNaissance" formControlName="dateNaissance" class="form-control">
        </div>
        
        <div class="form-group">
          <label for="titreCV">Titre du CV</label>
          <input type="text" id="titreCV" formControlName="titreCV" class="form-control" placeholder="D√©veloppeur Full Stack">
        </div>
      </div>

      <div class="form-group">
        <label for="photo">Photo de profil</label>
        
        <div class="photo-upload-container">
          <!-- Pr√©visualisation de la photo -->
          <div class="photo-preview" *ngIf="photoPreview">
            <img [src]="photoPreview" alt="Aper√ßu de la photo">
          </div>
          
          <!-- Bouton de s√©lection de fichier -->
          <div class="file-input-wrapper">
            <input 
              type="file" 
              id="photo" 
              accept="image/*" 
              (change)="onFileSelected($event)"
              class="file-input"
            >
            <label for="photo" class="file-input-label">
              üì∑ Changer la photo
            </label>
          </div>
          
          <!-- Indicateur de chargement -->
          <div class="upload-status" *ngIf="uploadingPhoto">
            <div class="spinner-small"></div>
            <span>Upload en cours...</span>
          </div>
          
          <!-- Nom du fichier s√©lectionn√© -->
          <p class="file-name" *ngIf="selectedFile && !uploadingPhoto">
            Fichier s√©lectionn√© : {{ selectedFile.name }}
          </p>
        </div>
        
        <!-- Option alternative : URL -->
        <div class="or-divider">
          <span>OU</span>
        </div>
        
        <label for="photoUrl">URL de la photo (optionnel)</label>
        <input type="url" id="photoUrl" formControlName="photoUrl" class="form-control" placeholder="https://...">
      </div>
    </div>

    <div class="form-step" *ngIf="currentStep === 2">
      <h2>üéì Formations</h2>
      
      <div formArrayName="formations">
        <div *ngFor="let formation of formations.controls; let i = index" [formGroupName]="i" class="array-item">
          <h3>Formation {{ i + 1 }}</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label>Intitul√© *</label>
              <input type="text" formControlName="intitule" class="form-control" placeholder="Master Informatique">
            </div>
            
            <div class="form-group">
              <label>√âtablissement *</label>
              <input type="text" formControlName="etablissement" class="form-control" placeholder="Universit√©">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Ann√©e d√©but *</label>
              <input type="number" formControlName="anneeDebut" class="form-control" placeholder="2020">
            </div>
            
            <div class="form-group">
              <label>Ann√©e fin</label>
              <input type="number" formControlName="anneeFin" class="form-control" placeholder="2022">
            </div>
            
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="enCours">
                En cours
              </label>
            </div>
          </div>

          <div class="form-group">
            <label>Description</label>
            <textarea formControlName="description" class="form-control" rows="3"></textarea>
          </div>

          <button type="button" class="btn btn-danger" (click)="removeFormation(i)">Supprimer</button>
        </div>
      </div>

      <button type="button" class="btn btn-secondary" (click)="addFormation()">+ Ajouter une formation</button>
    </div>

    <div class="form-step" *ngIf="currentStep === 3">
      <h2>üíº Exp√©riences</h2>
      
      <div formArrayName="experiences">
        <div *ngFor="let experience of experiences.controls; let i = index" [formGroupName]="i" class="array-item">
          <h3>Exp√©rience {{ i + 1 }}</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label>Poste *</label>
              <input type="text" formControlName="poste" class="form-control" placeholder="D√©veloppeur">
            </div>
            
            <div class="form-group">
              <label>Entreprise *</label>
              <input type="text" formControlName="entreprise" class="form-control" placeholder="TechCorp">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Date d√©but *</label>
              <input type="date" formControlName="dateDebut" class="form-control">
            </div>
            
            <div class="form-group">
              <label>Date fin</label>
              <input type="date" formControlName="dateFin" class="form-control">
            </div>
            
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="enCours">
                En cours
              </label>
            </div>
          </div>

          <div class="form-group">
            <label>Lieu</label>
            <input type="text" formControlName="lieu" class="form-control" placeholder="Paris">
          </div>

          <div class="form-group">
            <label>Missions</label>
            <textarea formControlName="missions" class="form-control" rows="4"></textarea>
          </div>

          <button type="button" class="btn btn-danger" (click)="removeExperience(i)">Supprimer</button>
        </div>
      </div>

      <button type="button" class="btn btn-secondary" (click)="addExperience()">+ Ajouter une exp√©rience</button>
    </div>

    <div class="form-step" *ngIf="currentStep === 4">
      <h2>üß™ Stages</h2>
      
      <div formArrayName="stages">
        <div *ngFor="let stage of stages.controls; let i = index" [formGroupName]="i" class="array-item">
          <h3>Stage {{ i + 1 }}</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label>Intitul√© *</label>
              <input type="text" formControlName="intitule" class="form-control">
            </div>
            
            <div class="form-group">
              <label>Entreprise *</label>
              <input type="text" formControlName="entreprise" class="form-control">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Date d√©but *</label>
              <input type="date" formControlName="dateDebut" class="form-control">
            </div>
            
            <div class="form-group">
              <label>Date fin *</label>
              <input type="date" formControlName="dateFin" class="form-control">
            </div>
          </div>

          <div class="form-group">
            <label>Lieu</label>
            <input type="text" formControlName="lieu" class="form-control">
          </div>

          <div class="form-group">
            <label>Description</label>
            <textarea formControlName="description" class="form-control" rows="3"></textarea>
          </div>

          <button type="button" class="btn btn-danger" (click)="removeStage(i)">Supprimer</button>
        </div>
      </div>

      <button type="button" class="btn btn-secondary" (click)="addStage()">+ Ajouter un stage</button>
    </div>

    <div class="form-step" *ngIf="currentStep === 5">
      <h2>üåç Langues</h2>
      
      <div formArrayName="langues">
        <div *ngFor="let langue of langues.controls; let i = index" [formGroupName]="i" class="array-item">
          <div class="form-row">
            <div class="form-group">
              <label>Langue *</label>
              <input type="text" formControlName="nom" class="form-control" placeholder="Fran√ßais">
            </div>
            
            <div class="form-group">
              <label>Niveau *</label>
              <select formControlName="niveau" class="form-control">
                <option value="">S√©lectionner</option>
                <option value="D√©butant">D√©butant</option>
                <option value="Interm√©diaire">Interm√©diaire</option>
                <option value="Avanc√©">Avanc√©</option>
                <option value="Courant">Courant</option>
                <option value="Langue maternelle">Langue maternelle</option>
              </select>
            </div>
            
            <div class="form-group" style="flex: 0 0 auto;">
              <label>&nbsp;</label>
              <button type="button" class="btn btn-danger" (click)="removeLangue(i)">X</button>
            </div>
          </div>
        </div>
      </div>

      <button type="button" class="btn btn-secondary" (click)="addLangue()">+ Ajouter une langue</button>
    </div>

    <div class="form-step" *ngIf="currentStep === 6">
      <h2>üõ† Comp√©tences</h2>
      
      <div formArrayName="competences">
        <div *ngFor="let competence of competences.controls; let i = index" [formGroupName]="i" class="array-item">
          <div class="form-row">
            <div class="form-group">
              <label>Comp√©tence *</label>
              <input type="text" formControlName="nom" class="form-control" placeholder="Java">
            </div>
            
            <div class="form-group">
              <label>Niveau (1-5)</label>
              <input type="number" formControlName="niveau" class="form-control" min="1" max="5">
            </div>
            
            <div class="form-group">
              <label>Cat√©gorie</label>
              <select formControlName="categorie" class="form-control">
                <option value="">S√©lectionner</option>
                <option value="Technique">Technique</option>
                <option value="Soft Skills">Soft Skills</option>
                <option value="Logiciel">Logiciel</option>
                <option value="Autre">Autre</option>
              </select>
            </div>
            
            <div class="form-group" style="flex: 0 0 auto;">
              <label>&nbsp;</label>
              <button type="button" class="btn btn-danger" (click)="removeCompetence(i)">X</button>
            </div>
          </div>
        </div>
      </div>

      <button type="button" class="btn btn-secondary" (click)="addCompetence()">+ Ajouter une comp√©tence</button>
    </div>

    <div class="form-navigation">
      <button type="button" class="btn btn-secondary" (click)="previousStep()" [disabled]="currentStep === 1">
        ‚Üê Pr√©c√©dent
      </button>
      
      <button type="button" class="btn btn-primary" (click)="nextStep()" *ngIf="currentStep < totalSteps">
        Suivant ‚Üí
      </button>
      
      <button type="submit" class="btn btn-success" *ngIf="currentStep === totalSteps">
        ‚úì Enregistrer les modifications
      </button>
    </div>
  </form>
</div>

<div class="loading" *ngIf="loading">
  <div class="spinner"></div>
  <p>Chargement du CV...</p>
</div>